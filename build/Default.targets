<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTargets="Build">

    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
        <BuildDependsOn>$(BuildDependsOn);_PublishApplication</BuildDependsOn>
        
        <PublishApplication Condition="'$(PublishApplication)' == '' AND '$(PublishApplicationName)' != ''">true</PublishApplication>
    </PropertyGroup>
   
    <Target Name="_PublishApplication">
        <ItemGroup>
            <_OutputFiles Include="$(OutputPath)\**\*" Exclude="$(OutputPath)\refs\**" />
        </ItemGroup>

        <PropertyGroup>
            <_PublishDestination>$(BuildArtifactsPath)\app\$(PublishApplicationName)</_PublishDestination>
        </PropertyGroup>

        <Message Text="Publishing from '$(OutputPath)' to '$(_PublishDestination)'"/>

        <Copy SourceFiles="@(_OutputFiles)" DestinationFolder="$(_PublishDestination)\%(RecursiveDir)" 
              OverwriteReadOnlyFiles="true" SkipUnchangedFiles="true" Condition="'$(PublishApplication)' == 'true'" />
    </Target>

</Project>
